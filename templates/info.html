{% extends "base.html" %}
{% block title %}Info - Trading Journal{% endblock %}
{% block content %}
<h2>Actualités</h2>

{% if session.get('is_admin') %}
  <h4>Créer une Publication</h4>
  <form method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <label for="titre">Titre</label>
      <input type="text" class="form-control" name="titre" required>
    </div>
    <div class="form-group">
      <label for="contenu">Contenu</label>
      <textarea class="form-control" name="contenu" rows="5" required></textarea>
    </div>
    <div class="form-group">
      <label for="media">Fichier Média (audio/vidéo/image, facultatif)</label>
      <input type="file" class="form-control-file" name="media">
    </div>
    <button type="submit" class="btn btn-primary">Publier</button>
  </form>
  <hr>
{% endif %}

<style>
  .card {
    width: 18rem;
    position: relative;
    background-size: cover;
  }
  .card-body {
    background: rgba(0, 0, 0, 0.5);
    color: white;
  }
</style>

<div class="d-flex flex-wrap">
  {% if posts %}
    {% for post in posts %}
      <div class="card m-2"
        {% if post.media %}
          style="background-image: url('{{ url_for('uploaded_file', filename=post.media) }}');"
        {% endif %}
      >
        <div class="card-body">
          <h5 class="card-title">{{ post.titre }}</h5>
          <p class="card-text">{{ post.contenu }}</p>
          <small>{{ post.date_creation }}</small>
          {% if session.get('is_admin') %}
            <div class="mt-2">
              <a href="{{ url_for('edit_info', post_id=post.id) }}" class="btn btn-warning btn-sm">Modifier</a>
              <form method="POST" action="{{ url_for('delete_info', post_id=post.id) }}" style="display: inline;">
                <button type="submit" class="btn btn-danger btn-sm">Supprimer</button>
              </form>
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>Aucune publication disponible.</p>
  {% endif %}
</div>
{% endblock %}
